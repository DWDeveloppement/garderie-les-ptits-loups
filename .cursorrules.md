# 🎯 Règles Cursor - Garderie Les P'tits Loups

## Stack Technique
- **Framework** : Next.js 15 + TypeScript + Tailwind CSS v4
- **UI** : Radix UI primitives + Radix Theme
- **Palette** : Orange (neutre) + Purple (accent)
- **CMS** : Sanity
- **Email** : Resend

## Scripts de Développement
- **Dev** : `npm run dev` (port 3000)
- **Build** : `npm run build`
- **Start** : `npm run start` (port 3100)
- **Start Dev** : `npm run start:dev` (port 3000)
- **Sanity** : `npm run sanity` (studio CMS)
- **Clean** : `npm run clean` (supprime .next)
- **Refresh** : `npm run refresh` (clean + dev)
- **Review** : `npm run review` (clean + build + start)

## Installation Radix Theme
```bash
npm install @radix-ui/themes
```

## Structure du Projet
```
src/
├── app/              # Pages Next.js (routing)
├── components/
│   ├── ui/           # Composants Radix Theme purs
│   ├── shared/       # Composants custom réutilisables
│   ├── pages/        # Sections de pages (Hero, Contact, etc.)
│   └── examples/     # Composants d'exemple
├── hooks/            # Hooks personnalisés
├── lib/              # Utilitaires (utils.ts, theme-utils.ts)
├── styles/           # CSS (palette.css)
└── types/            # Types TypeScript
```

## Conventions de Code
- **TypeScript** : Strict, `type` au lieu d'`interface`
- **Nommage** : PascalCase composants, camelCase fonctions
- **Styles** : Tailwind CSS avec palette Orange/Purple
- **Commentaires** : En français

## Palette de Couleurs
- **Purple** : Accent (boutons, liens) - `accentColor="purple"`
- **Orange** : Neutre (backgrounds, borders) - `grayColor="gray"` (Orange custom)
- **Usage** : `bg-purple-9`, `text-gray-11`, `border-gray-6`
- **Simplicité** : Pas de display-p3, échelle OKLCH simple

## Composants Existants
- **ui/** : Button, Card, Toast (Radix Theme purs)
- **shared/** : BackToTop, MobileNavigation, StaticMap, DynamicMap, BottomBar (Toolbar), etc.
- **ContactForm** : Validation, localStorage, reCAPTCHA
- **Maps** : OpenStreetMap + Leaflet (pas Google Maps)
- **Navigation** : Mobile bottom bar avec auto-hide (Radix Toolbar)

## Migration Shadcn → Radix Theme
- **Remplacer** progressivement les composants Shadcn
- **Utiliser** les variants Radix natifs
- **Éviter** les conflits de styles
- **Maintenir** la cohérence visuelle

## Approche Couleurs
- **Radix Theme** : `accentColor="purple"`, `grayColor="gray"` (Orange custom)
- **Orange comme gray** : Variables CSS `--gray-*` dans `globals.css`
- **Utilitaires** : `src/lib/theme-utils.ts` pour la configuration
- **Simplicité** : Une seule échelle de couleurs, pas de display-p3

## Règles de Développement
1. **Utiliser** les composants existants
2. **Respecter** la palette Orange/Purple
3. **Créer** des composants modulaires
4. **Privilégier** la simplicité et la maintenabilité
5. **Radix Theme uniquement** : Pas de mélange avec Shadcn UI
6. **Variants Radix** : Utiliser les variants natifs (color, size, variant)
7. **Cohérence** : Garder une approche unifiée pour les styles

## 🎯 Stratégie Design Solutions

### Approche Hybride Radix + HTML/Tailwind
**Principe** : Utiliser le meilleur des deux mondes selon le contexte

#### ✅ **Utiliser Radix Theme quand :**
- **Interactions** : Hover, focus, états actifs
- **Accessibilité** : Composants complexes (forms, modals, dropdowns)
- **Fonctionnalités** : Props Radix utiles (color, size, variant)
- **Cohérence** : Design system uniforme

**Exemples** : Button, Card avec hover, Form components, Toast

#### ⚡ **Utiliser HTML/Tailwind brut quand :**
- **Conflits CSS** : Radix écrase les styles (display, flex, grid)
- **Performance** : Composants simples sans interactions
- **Contrôle total** : Layout complexe, positioning précis
- **Bundle size** : Éviter le JavaScript Radix inutile

**Exemples** : DynamicMap (div brut), Layout containers, Static elements

### 🔧 **Implémentation Pratique**

#### **Composants Radix (avec classes de base)**
```tsx
// card.tsx
const CARD_BASE_CLASSES = 'rounded-lg overflow-hidden border p-0'

const Card = ({ children, ...props }) => (
  <RadixCard className={`${CARD_BASE_CLASSES} ${props.className || ''}`}>
    {children}
  </RadixCard>
)
```

#### **Composants HTML/Tailwind (pour cas spéciaux)**
```tsx
// DynamicMap.tsx
<div className='relative rounded-lg overflow-hidden border border-orange-6 p-0'>
  {/* Contenu sans conflits CSS */}
</div>
```

### 📋 **Décision Tree**
1. **Besoin d'interactions ?** → Radix Theme
2. **Conflits CSS Radix ?** → HTML/Tailwind brut
3. **Composant simple ?** → HTML/Tailwind brut
4. **Accessibilité complexe ?** → Radix Theme
5. **Performance critique ?** → HTML/Tailwind brut

### 🎨 **Avantages de cette approche**
- ✅ **Flexibilité** : Solution adaptée au contexte
- ✅ **Performance** : Pas de JavaScript inutile
- ✅ **Maintenabilité** : Code prévisible et débogable
- ✅ **Évolutivité** : Migration progressive possible
- ✅ **Productivité** : Pas de lutte contre les conflits CSS

## Backend Sanity

### 🎯 Approche méthodologique
1. **Versioning** : Vérifier la compatibilité Sanity v3 vs v2
2. **Configuration** : Plugins et structure dans l'ordre des priorités
3. **Types** : Définir les schémas avant l'implémentation
4. **Validation** : Tests en local avant déploiement

### 📊 Priorités développement Sanity

#### **Phase 1 : Fondations**
1. **Structure des types** : Pages, structures, espaces, prix, subventions
2. **Configuration de base** : Studio, plugins essentiels, structure de navigation
3. **Types TypeScript** : Génération automatique des types depuis les schémas

#### **Phase 2 : Contenu**
4. **Gestion des médias** : Upload, optimisation, références
5. **Validation des champs** : Obligatoires pour SEO et cohérence
6. **Rich Text** : Éditeur avec composants personnalisés (callout, blockquote)

#### **Phase 3 : Fonctionnalités avancées**
7. **Pages à slug** : Structure pour contenu dynamique
8. **Prévisualisation** : Live preview avec Next.js
9. **Requêtes GROQ** : Optimisation et cache

#### **Phase 4 : Finalisation**
10. **Thème personnalisé** : Interface utilisateur (optionnel)
11. **Déploiement** : Production et monitoring

### 🔧 Règles techniques

- **DRY** : Réutiliser les champs communs (`fields/`)
- **Séparation** : Champs vs Composants (`components/`)
- **Nommage** : `*Field` pour champs, `*Object` pour composants
- **Exports** : Centraliser avec `index.ts`

### ⚠️ Points d'attention

- **Migration v2→v3** : `deskTool` → `structureTool`
- **Performance** : Limiter les requêtes GROQ complexes
- **SEO** : Métadonnées obligatoires sur toutes les pages
- **Accessibilité** : Alt text obligatoire pour toutes les images

**Contexte actuel :** Migration Sanity v2→v3, problème "Structure"→"Contenu", préparation pages à slug

## Commandes Utiles

### Commandes à privilégier (plus lent mais plus sûr)
- **Développement** : `npm run refresh` (netoyage de cache et port 3000)
- **Production en local** : `npm run review` (netoyage de cache et port 3100)

### Commandes détaillées
- **Développement** : `npm run dev` (port 3000)
- **Production** : `npm run start` (port 3100)
- **Nettoyage** : `npm run clean` puis `npm run refresh`
- **Sanity Studio** : `npm run sanity`
- **Test complet** : `npm run review`
